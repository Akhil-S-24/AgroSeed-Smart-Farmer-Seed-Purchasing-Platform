<!-- Farmer Dashboard (simplified) -->
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Vendor Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="icon" href="{{ url_for('static', filename='farmer_seeds.png') }}" type="image/png">
</head>

<body class="bg-gray-50 text-gray-800 font-sans min-h-screen flex flex-col">


    <header class="bg-green-600 text-white p-6 flex items-center justify-between">
        <!-- Left Side: Title -->
        <h1 class="text-2xl font-bold">ðŸŒ¾ Vendor Dashboard</h1>

        <!-- Right Side: Buttons -->
        <div class="flex items-center gap-4">
            <button id="open-add-modal" class="bg-white text-green-600 px-4 py-2 rounded shadow hover:bg-gray-100">
                âž• Add Seed
            </button>
            <button id="view-orders-btn" class="bg-white text-green-600 px-4 py-2 rounded shadow hover:bg-gray-100">
                ðŸ“¦ View Orders
            </button>

            <form action="/logout" method="POST">
                <button type="submit" class="bg-red-600 text-white px-5 py-2 rounded hover:bg-red-700 transition">
                    Logout
                </button>
            </form>
        </div>
    </header>

    <!-- Seed Cards -->
    <main class="p-6 grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6 flex-grow" id="seed-container">
        <!-- Seed cards will be loaded via JS -->
    </main>
    <!-- Orders Modal -->
    <div id="orders-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50">
        <div class="bg-white p-6 rounded-lg w-full max-w-3xl relative shadow-xl overflow-y-auto max-h-[80vh]">
            <h2 class="text-xl font-bold mb-4">Orders for Your Seeds</h2>
            <div id="orders-list" class="space-y-4">
                <!-- Orders will load here -->
            </div>
            <button id="close-orders-modal" class="absolute top-2 right-3 text-lg text-red-600 font-bold">âœ•</button>
        </div>
    </div>

    <!-- Add Seed Modal -->
    <div id="add-seed-modal" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center z-50">
        <div class="bg-white p-6 rounded-lg w-full max-w-md relative shadow-xl">
            <h2 class="text-xl font-bold mb-4">Add New Seed</h2>
            <form id="add-seed-form" enctype="multipart/form-data">
                <input name="name" type="text" placeholder="Seed Name" required
                    class="w-full mb-3 px-3 py-2 border rounded" />
                <input name="seed_type" type="text" placeholder="Seed Type" required
                    class="w-full mb-3 px-3 py-2 border rounded" />
                <input name="price" type="number" placeholder="Price (â‚¹)" required
                    class="w-full mb-3 px-3 py-2 border rounded" />
                <input name="quantity" type="number" placeholder="Quantity (e.g., 50kg)" required
                    class="w-full mb-3 px-3 py-2 border rounded" />
                <input name="video_link" type="url" placeholder="Video Link"
                    class="w-full mb-3 px-3 py-2 border rounded" />
                <textarea name="instructions" placeholder="Instructions"
                    class="w-full mb-3 px-3 py-2 border rounded"></textarea>
                <input name="images" type="file" multiple accept="image/*" class="w-full mb-3 px-3 py-2 border rounded"
                    required />

                <button type="submit"
                    class="w-full bg-green-600 text-white py-2 rounded hover:bg-green-700">Submit</button>
            </form>
            <button id="close-add-modal" class="absolute top-2 right-2 text-lg text-red-600 font-bold">âœ•</button>
        </div>
    </div>
<!-- Footer -->
    <footer class="bg-gray-200 text-gray-600 text-center py-4 text-sm">
        &copy; 2025 Farmer Seed Selling Platform. All rights reserved.<br>
        <p>For any support contact at <a href="tel:+919346434880" class="text-blue-600 underline">+91 9346434880</a></p>
    </footer>
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const openModal = document.getElementById('open-add-modal');
            const closeModal = document.getElementById('close-add-modal');
            const modal = document.getElementById('add-seed-modal');
            const form = document.getElementById('add-seed-form');

            openModal.addEventListener('click', () => modal.classList.remove('hidden'));
            closeModal.addEventListener('click', () => modal.classList.add('hidden'));

            form.addEventListener('submit', async (e) => {
                e.preventDefault();
                const formData = new FormData(form);
                const res = await fetch('/api/farmer/add-seed', {
                    method: 'POST',
                    body: formData
                });
                const result = await res.json();
                if (res.ok) {
                    alert("Seed added!");
                    modal.classList.add('hidden');
                    form.reset();
                    // Optionally refresh cards
                } else {
                    alert(result.error || "Something went wrong");
                }
            });
        });
    </script>


    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const container = document.getElementById('seed-container');

            // Fetch seeds and create seed cards (existing code)
            fetch('/api/vendorseeds')
                .then(res => res.json())
                .then(seeds => {
                    seeds.forEach(seed => {
                        const card = document.createElement('div');
                        card.className = "bg-white rounded-xl shadow-md hover:shadow-xl transition duration-300 transform hover:-translate-y-1";
                        card.innerHTML = `
                    <div class="bg-white rounded-xl shadow-xl overflow-hidden transform transition hover:scale-105 duration-300">
                        <img src="${seed.images[0]}" alt="${seed.name}" class="w-full h-48 object-cover">
                        <div class="p-4">
                            <h3 class="text-2xl font-bold text-green-700 mb-2">${seed.name}</h3>
                            <p class="text-gray-600 mb-1"><span class="font-semibold">Type:</span> ${seed.type}</p>
                            <p class="text-gray-600 mb-1"><span class="font-semibold">Quantity:</span> ${seed.quantity}</p>
                            <p class="text-gray-800 font-semibold text-lg mb-4">â‚¹ ${seed.price}</p>
                            
                            <!-- Delete Button -->
                            <button class="w-full bg-red-600 hover:bg-red-700 text-white font-semibold py-2 rounded delete-btn" data-id="${seed._id}">
                                Delete Seed
                            </button>
                        </div>
                    </div>
                `;
                        container.appendChild(card);
                    });

                    // Add event listener to delete buttons
                    const deleteButtons = document.querySelectorAll('.delete-btn');
                    deleteButtons.forEach(button => {
                        button.addEventListener('click', (e) => {
                            const seedId = e.target.dataset.id;
                            deleteSeed(seedId);
                        });
                    });
                });

            // Function to handle seed deletion
            function deleteSeed(seedId) {
                // Send an AJAX request to the backend
                fetch(`/api/farmer/delete-seed/${seedId}`, {
                    method: 'DELETE'
                })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            alert("Seed deleted successfully.");
                            // Optionally, remove the seed from the UI
                            const seedCard = document.querySelector(`button[data-id='${seedId}']`).closest('.bg-white');
                            seedCard.remove();
                        } else {
                            alert("Failed to delete seed.");
                        }
                    })
                    .catch(error => {
                        console.error("Error deleting seed:", error);
                        alert("An error occurred while deleting the seed.");
                    });
            }
        });





        document.getElementById("view-orders-btn").addEventListener("click", () => {
            fetch("/api/vendor/orders")
                .then(res => res.json())
                .then(data => {
                    
                    const list = document.getElementById("orders-list");
                    list.innerHTML = "";

                    if (data.length === 0) {
                        list.innerHTML = "<p class='text-gray-600'>No orders found.</p>";
                    } else {
                        data.forEach(order => {
                            console.log(order)
                            const div = document.createElement("div");
                            div.className = "border p-4 rounded shadow";
                            div.innerHTML = `
    <h3 class="text-lg font-semibold text-green-700">${order.seed_name}</h3>
    <p><strong>Quantity:</strong> ${order.quantity}</p>
    <p><strong>Price:</strong> â‚¹${order.price}</p>
    <p><strong>Booked On:</strong> ${new Date(order.timestamp).toLocaleString()}</p>
    <p><strong>Status:</strong> ${order.status}</p>
    <p><strong>Customer Name:</strong> ${order.customer.name}</p>
    <p><strong>Customer Mobile number:</strong> ${order.customer.phone}</p>
    <p><strong>Customer Address:</strong> ${order.customer.address}</p>
    <div class="flex gap-3 mt-2">
    ${order.status === 'Pending' ? `
    <button class="accept-btn bg-green-600 text-white px-3 py-1 rounded" data-id="${order._id}">Accept & Confirm</button>
    <button class="cancel-btn bg-red-600 text-white px-3 py-1 rounded" data-id="${order._id}">Cancel Order</button>
` : order.status === 'Confirmed' ? `
    <button class="complete-btn bg-blue-600 text-white px-3 py-1 rounded" data-id="${order._id}">Mark as Completed</button>
` : ''}
`;
                            list.appendChild(div);
                        });

                        // Add event listeners to action buttons
                        document.querySelectorAll('.accept-btn').forEach(btn => {
                            btn.addEventListener('click', () => updateOrderStatus(btn.dataset.id, 'Confirmed'));
                        });
                        document.querySelectorAll('.cancel-btn').forEach(btn => {
                            btn.addEventListener('click', () => updateOrderStatus(btn.dataset.id, 'Cancelled'));
                        });

                        document.querySelectorAll('.complete-btn').forEach(btn => {
                            btn.addEventListener('click', () => updateOrderStatus(btn.dataset.id, 'Completed'));
                        });

                    }

                    document.getElementById("orders-modal").classList.remove("hidden");
                });
        });

        document.getElementById("close-orders-modal").addEventListener("click", () => {
            document.getElementById("orders-modal").classList.add("hidden");
        });

        function updateOrderStatus(orderId, status) {
            fetch(`/api/vendor/orders/${orderId}`, {
                method: 'PUT',
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({ status })
            }).then(res => res.json())
                .then(data => {
                    alert(`Order ${status}`);
                    document.getElementById("view-orders-btn").click(); // Refresh orders
                });
        }

    </script>

</body>

</html>